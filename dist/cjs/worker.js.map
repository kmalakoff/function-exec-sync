{"version":3,"sources":["worker.ts"],"sourcesContent":["require('./polyfills');\nconst fs = require('fs');\nconst serialize = require('serialize-javascript');\nconst compat = require('async-compat');\n\nconst input = process.argv[2];\nconst output = process.argv[3];\n\nfunction writeResult(result) {\n  fs.writeFile(output + '.tmp', serialize(result), 'utf8', function () {\n    fs.rename(output + '.tmp', output, function () {\n      process.exit(0);\n    });\n  });\n}\n\n// get data\ntry {\n  const workerData = eval(`(${fs.readFileSync(input, 'utf8')})`);\n\n  // set up env\n  if (process.cwd() !== workerData.cwd) process.chdir(workerData.cwd);\n  for (const key in workerData.env) {\n    if (process.env[key] === undefined) process.env[key] = workerData.env[key];\n  }\n\n  // call function\n  const fn = require(workerData.filePath);\n  if (typeof fn !== 'function') {\n    writeResult({ value: fn });\n  }\n  else {\n    const args = [fn, workerData.callbacks].concat(workerData.args);\n    args.push((err, value) => {\n      err ? writeResult({ error: { message: err.message, stack: err.stack } }) : writeResult({value});\n    })\n    compat.asyncFunction.apply(null, args);  \n  }\n} catch (err) {\n  writeResult({ error: { message: err.message, stack: err.stack } });\n}\n"],"names":["require","fs","serialize","compat","input","process","argv","output","writeResult","result","writeFile","rename","exit","workerData","eval","readFileSync","cwd","chdir","key","env","undefined","fn","filePath","value","args","callbacks","concat","push","err","error","message","stack","asyncFunction","apply"],"mappings":"AAAAA;AAAAA,OAAO,CAAC,aAAa,CAAC,CAAC;AACvB,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC,AAAC;AACzB,IAAME,SAAS,GAAGF,OAAO,CAAC,sBAAsB,CAAC,AAAC;AAClD,IAAMG,MAAM,GAAGH,OAAO,CAAC,cAAc,CAAC,AAAC;AAEvC,IAAMI,KAAK,GAAGC,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAC9B,IAAMC,MAAM,GAAGF,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAE/B,SAASE,WAAW,CAACC,MAAM,EAAE;IAC3BR,EAAE,CAACS,SAAS,CAACH,MAAM,GAAG,MAAM,EAAEL,SAAS,CAACO,MAAM,CAAC,EAAE,MAAM,EAAE,WAAY;QACnER,EAAE,CAACU,MAAM,CAACJ,MAAM,GAAG,MAAM,EAAEA,MAAM,EAAE,WAAY;YAC7CF,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC,CAAC;SACjB,CAAC,CAAC;KACJ,CAAC,CAAC;CACJ;AAED,WAAW;AACX,IAAI;IACF,IAAMC,UAAU,GAAGC,IAAI,CAAC,AAAC,GAAC,CAAiC,MAAC,CAAhCb,EAAE,CAACc,YAAY,CAACX,KAAK,EAAE,MAAM,CAAC,EAAC,GAAC,CAAC,CAAC,AAAC;IAE/D,aAAa;IACb,IAAIC,OAAO,CAACW,GAAG,EAAE,KAAKH,UAAU,CAACG,GAAG,EAAEX,OAAO,CAACY,KAAK,CAACJ,UAAU,CAACG,GAAG,CAAC,CAAC;IACpE,IAAK,IAAME,GAAG,IAAIL,UAAU,CAACM,GAAG,CAAE;QAChC,IAAId,OAAO,CAACc,GAAG,CAACD,GAAG,CAAC,KAAKE,SAAS,EAAEf,OAAO,CAACc,GAAG,CAACD,GAAG,CAAC,GAAGL,UAAU,CAACM,GAAG,CAACD,GAAG,CAAC,CAAC;KAC5E;IAED,gBAAgB;IAChB,IAAMG,EAAE,GAAGrB,OAAO,CAACa,UAAU,CAACS,QAAQ,CAAC,AAAC;IACxC,IAAI,OAAOD,EAAE,KAAK,UAAU,EAAE;QAC5Bb,WAAW,CAAC;YAAEe,KAAK,EAAEF,EAAE;SAAE,CAAC,CAAC;KAC5B,MACI;QACH,IAAMG,IAAI,GAAG;YAACH,EAAE;YAAER,UAAU,CAACY,SAAS;SAAC,CAACC,MAAM,CAACb,UAAU,CAACW,IAAI,CAAC,AAAC;QAChEA,IAAI,CAACG,IAAI,CAAC,SAACC,GAAG,EAAEL,KAAK,EAAK;YACxBK,GAAG,GAAGpB,WAAW,CAAC;gBAAEqB,KAAK,EAAE;oBAAEC,OAAO,EAAEF,GAAG,CAACE,OAAO;oBAAEC,KAAK,EAAEH,GAAG,CAACG,KAAK;iBAAE;aAAE,CAAC,GAAGvB,WAAW,CAAC;gBAACe,KAAK,EAALA,KAAK;aAAC,CAAC,CAAC;SACjG,CAAC;QACFpB,MAAM,CAAC6B,aAAa,CAACC,KAAK,CAAC,IAAI,EAAET,IAAI,CAAC,CAAC;KACxC;CACF,CAAC,OAAOI,GAAG,EAAE;IACZpB,WAAW,CAAC;QAAEqB,KAAK,EAAE;YAAEC,OAAO,EAAEF,GAAG,CAACE,OAAO;YAAEC,KAAK,EAAEH,GAAG,CAACG,KAAK;SAAE;KAAE,CAAC,CAAC;CACpE"}