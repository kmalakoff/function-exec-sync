{"version":3,"sources":["worker.ts"],"sourcesContent":["require('./polyfills');\nconst fs = require('fs');\nconst serialize = require('serialize-javascript');\nconst compat = require('async-compat');\n\nconst input = process.argv[2];\nconst output = process.argv[3];\n\nfunction writeResult(result) {\n  fs.writeFile(output + '.tmp', serialize(result), 'utf8', function () {\n    fs.rename(output + '.tmp', output, function () {\n      process.exit(0);\n    });\n  });\n}\n\nfunction writeError(error) {\n  const result = { error: { message: error.message, stack: error.stack }};\n  for (const key in error) result.error[key] = error[key];\n  writeResult(result);\n}\n\n// get data\ntry {\n  const workerData = eval(`(${fs.readFileSync(input, 'utf8')})`);\n\n  // set up env\n  if (process.cwd() !== workerData.cwd) process.chdir(workerData.cwd);\n  for (const key in workerData.env) {\n    if (process.env[key] === undefined) process.env[key] = workerData.env[key];\n  }\n\n  // call function\n  const fn = require(workerData.filePath);\n  if (typeof fn !== 'function') {\n    writeResult({ value: fn });\n  } else {\n    const args = [fn, workerData.callbacks].concat(workerData.args);\n    args.push((err, value) => {\n      err ? writeError(err) : writeResult({ value });\n    });\n    compat.asyncFunction.apply(null, args);\n  }\n} catch (err) {\n  writeError(err);\n}\n"],"names":["require","fs","serialize","compat","input","process","argv","output","writeResult","result","writeFile","rename","exit","writeError","error","message","stack","key","workerData","eval","readFileSync","cwd","chdir","env","undefined","fn","filePath","value","args","callbacks","concat","push","err","asyncFunction","apply"],"mappings":"AAAAA;AAAAA,OAAO,CAAC,aAAa,CAAC,CAAC;AACvB,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC,AAAC;AACzB,IAAME,SAAS,GAAGF,OAAO,CAAC,sBAAsB,CAAC,AAAC;AAClD,IAAMG,MAAM,GAAGH,OAAO,CAAC,cAAc,CAAC,AAAC;AAEvC,IAAMI,KAAK,GAAGC,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAC9B,IAAMC,MAAM,GAAGF,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAE/B,SAASE,WAAW,CAACC,MAAM,EAAE;IAC3BR,EAAE,CAACS,SAAS,CAACH,MAAM,GAAG,MAAM,EAAEL,SAAS,CAACO,MAAM,CAAC,EAAE,MAAM,EAAE,WAAY;QACnER,EAAE,CAACU,MAAM,CAACJ,MAAM,GAAG,MAAM,EAAEA,MAAM,EAAE,WAAY;YAC7CF,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC,CAAC;SACjB,CAAC,CAAC;KACJ,CAAC,CAAC;CACJ;AAED,SAASC,UAAU,CAACC,KAAK,EAAE;IACzB,IAAML,MAAM,GAAG;QAAEK,KAAK,EAAE;YAAEC,OAAO,EAAED,KAAK,CAACC,OAAO;YAAEC,KAAK,EAAEF,KAAK,CAACE,KAAK;SAAE;KAAC,AAAC;IACxE,IAAK,IAAMC,GAAG,IAAIH,KAAK,CAAEL,MAAM,CAACK,KAAK,CAACG,GAAG,CAAC,GAAGH,KAAK,CAACG,GAAG,CAAC,CAAC;IACxDT,WAAW,CAACC,MAAM,CAAC,CAAC;CACrB;AAED,WAAW;AACX,IAAI;IACF,IAAMS,UAAU,GAAGC,IAAI,CAAC,AAAC,GAAC,CAAiC,MAAC,CAAhClB,EAAE,CAACmB,YAAY,CAAChB,KAAK,EAAE,MAAM,CAAC,EAAC,GAAC,CAAC,CAAC,AAAC;IAE/D,aAAa;IACb,IAAIC,OAAO,CAACgB,GAAG,EAAE,KAAKH,UAAU,CAACG,GAAG,EAAEhB,OAAO,CAACiB,KAAK,CAACJ,UAAU,CAACG,GAAG,CAAC,CAAC;IACpE,IAAK,IAAMJ,GAAG,IAAIC,UAAU,CAACK,GAAG,CAAE;QAChC,IAAIlB,OAAO,CAACkB,GAAG,CAACN,GAAG,CAAC,KAAKO,SAAS,EAAEnB,OAAO,CAACkB,GAAG,CAACN,GAAG,CAAC,GAAGC,UAAU,CAACK,GAAG,CAACN,GAAG,CAAC,CAAC;KAC5E;IAED,gBAAgB;IAChB,IAAMQ,EAAE,GAAGzB,OAAO,CAACkB,UAAU,CAACQ,QAAQ,CAAC,AAAC;IACxC,IAAI,OAAOD,EAAE,KAAK,UAAU,EAAE;QAC5BjB,WAAW,CAAC;YAAEmB,KAAK,EAAEF,EAAE;SAAE,CAAC,CAAC;KAC5B,MAAM;QACL,IAAMG,IAAI,GAAG;YAACH,EAAE;YAAEP,UAAU,CAACW,SAAS;SAAC,CAACC,MAAM,CAACZ,UAAU,CAACU,IAAI,CAAC,AAAC;QAChEA,IAAI,CAACG,IAAI,CAAC,SAACC,GAAG,EAAEL,KAAK,EAAK;YACxBK,GAAG,GAAGnB,UAAU,CAACmB,GAAG,CAAC,GAAGxB,WAAW,CAAC;gBAAEmB,KAAK,EAALA,KAAK;aAAE,CAAC,CAAC;SAChD,CAAC,CAAC;QACHxB,MAAM,CAAC8B,aAAa,CAACC,KAAK,CAAC,IAAI,EAAEN,IAAI,CAAC,CAAC;KACxC;CACF,CAAC,OAAOI,GAAG,EAAE;IACZnB,UAAU,CAACmB,GAAG,CAAC,CAAC;CACjB"}